### Podman configuring application access.

- A port on the container host is exposed and forwards traffic to the container port.
- Port mappings are set while starting the container.
- Rootless containers can only map to a non-privileged port (higher than 1024)

### Running a rootless container, but using a priviledge port 80 and it fails.

```
[student@test ~]$ podman search nginx | grep registry.redhat.io
registry.redhat.io/rhel8/nginx-114                Platform for running nginx 1.14 or building...
registry.redhat.io/rhel8/nginx-118                Platform for running nginx 1.18 or building...
registry.redhat.io/rhel8/nginx-120                Platform for running nginx 1.20 or building...
registry.redhat.io/ubi8/nginx-120                 Platform for running nginx 1.20 or building...
registry.redhat.io/ubi9/nginx-120                 Platform for running nginx 1.20 or building...
registry.redhat.io/rhel8/nginx-122                Platform for running nginx 1.22 or building...
registry.redhat.io/rhel9/nginx-122                Platform for running nginx 1.22 or building...
registry.redhat.io/rhel10/nginx-126               Platform for running nginx 1.26 or building...
registry.redhat.io/rhel8/nginx-116                Platform for running nginx 1.16 or building...
registry.redhat.io/ubi8/nginx-118                 Platform for running nginx 1.18 or building...
registry.redhat.io/rhel9/nginx-120                Platform for running nginx 1.20 or building...
registry.redhat.io/ubi8/nginx-122                 Platform for running nginx 1.22 or building...
registry.redhat.io/ubi9/nginx-122                 Platform for running nginx 1.22 or building...
registry.redhat.io/rhel9/nginx-124                Platform for running nginx 1.24or building n...
registry.redhat.io/ubi9/nginx-124                 Platform for running nginx 1.24 or building...
registry.redhat.io/rhel8/nginx-124                Platform for running nginx 1.24 or building...
registry.redhat.io/ubi8/nginx-124                 Platform for running nginx 1.24 or building...
registry.redhat.io/ubi10/nginx-126                Platform for running nginx 1.26 or building...
registry.redhat.io/ubi9/nginx-126                 Platform for running nginx 1.26 or building...
registry.redhat.io/rhel9/nginx-126                Platform for running nginx 1.24or building n...
registry.redhat.io/rhscl/nginx-16-rhel7           Nginx 1.6 server and a reverse proxy server
registry.redhat.io/rhscl/nginx-112-rhel7          Platform for running nginx 1.12 or building...
registry.redhat.io/rhscl/nginx-116-rhel7          Platform for running nginx 1.16 or building...
registry.redhat.io/ubi7/nginx-118                 Platform for running nginx 1.18 or building...
registry.redhat.io/rhscl/nginx-120-rhel7          Platform for running nginx 1.20 or building...
```

### The rootless container can't acces port 80, so it fails as expected.

```
[student@test ~]$ podman run -d -p 80:80 registry.redhat.io/ubi9/nginx-120
Trying to pull registry.redhat.io/ubi9/nginx-120:latest...
Getting image source signatures
Checking if image destination supports signatures
Copying blob d9ce76bfbf66 skipped: already exists
Copying blob 7177ace12430 done   |
Copying blob 208dfedcaf81 skipped: already exists
Copying config b0f652ce21 done   |
Writing manifest to image destination
Storing signatures
Error: pasta failed with exit code 1:
Failed to bind port 80 (Permission denied) for option '-t 80-80:80-80'

[student@test ~]$ podman ps -a
CONTAINER ID  IMAGE                                     COMMAND               CREATED         STATUS                    PORTS                                   NAMES
ed9fe2f0285d  registry.redhat.io/ubi9:latest            sleep 3600            11 hours ago    Exited (0) 292 years ago                                          ubi9-container
d390b5997c56  localhost/mymap:latest                    /usr/bin/nmap -sn...  10 hours ago    Exited (1) 10 hours ago                                           breezy
9d29c5daa855  localhost/mymap:latest                    /usr/bin/nmap -sn...  3 hours ago     Exited (1) 3 hours ago                                            test
3ab1de5dc8aa  registry.redhat.io/ubi9/nginx-120:latest  /bin/sh -c $STI_S...  10 seconds ago  Created                   0.0.0.0:80->80/tcp, 8080/tcp, 8443/tcp  agitated_mclaren
```

### I reran the command using a non-privildege port and it completed successfully "Exit 0", but the container stopped.  According to my BFF I used a S2I container and not a runtime image.

```
[student@test ~]$ podman run -d -p 8080:80 registry.redhat.io/ubi9/nginx-120
a27437dcf6dc986641d52532d8965e457b2009a3d66c7e9344d6330b040825d2

[student@test ~]$ podman ps
CONTAINER ID  IMAGE       COMMAND     CREATED     STATUS      PORTS       NAMES

[student@test ~]$ podman ps -a
CONTAINER ID  IMAGE                                     COMMAND               CREATED         STATUS                     PORTS                                     NAMES
ed9fe2f0285d  registry.redhat.io/ubi9:latest            sleep 3600            11 hours ago    Exited (0) 292 years ago                                             ubi9-container
d390b5997c56  localhost/mymap:latest                    /usr/bin/nmap -sn...  10 hours ago    Exited (1) 10 hours ago                                              breezy
9d29c5daa855  localhost/mymap:latest                    /usr/bin/nmap -sn...  3 hours ago     Exited (1) 3 hours ago                                               test
3ab1de5dc8aa  registry.redhat.io/ubi9/nginx-120:latest  /bin/sh -c $STI_S...  5 minutes ago   Created                    0.0.0.0:80->80/tcp, 8080/tcp, 8443/tcp    agitated_mclaren
a27437dcf6dc  registry.redhat.io/ubi9/nginx-120:latest  /bin/sh -c $STI_S...  22 seconds ago  Exited (0) 22 seconds ago  0.0.0.0:8080->80/tcp, 8080/tcp, 8443/tcp  jolly_tesla
```

### This shows only 1 non builder image, fine for now.

```
[student@test ~]$ podman search nginx | grep registry.redhat.io
registry.redhat.io/rhel8/nginx-114                Platform for running nginx 1.14 or building...
registry.redhat.io/rhel8/nginx-118                Platform for running nginx 1.18 or building...
registry.redhat.io/rhel8/nginx-120                Platform for running nginx 1.20 or building...
registry.redhat.io/ubi8/nginx-120                 Platform for running nginx 1.20 or building...
registry.redhat.io/ubi9/nginx-120                 Platform for running nginx 1.20 or building...
registry.redhat.io/rhel8/nginx-122                Platform for running nginx 1.22 or building...
registry.redhat.io/rhel9/nginx-122                Platform for running nginx 1.22 or building...
registry.redhat.io/rhel10/nginx-126               Platform for running nginx 1.26 or building...
registry.redhat.io/rhel8/nginx-116                Platform for running nginx 1.16 or building...
registry.redhat.io/ubi8/nginx-118                 Platform for running nginx 1.18 or building...
registry.redhat.io/rhel9/nginx-120                Platform for running nginx 1.20 or building...
registry.redhat.io/ubi8/nginx-122                 Platform for running nginx 1.22 or building...
registry.redhat.io/ubi9/nginx-122                 Platform for running nginx 1.22 or building...
registry.redhat.io/rhel9/nginx-124                Platform for running nginx 1.24or building n...
registry.redhat.io/ubi9/nginx-124                 Platform for running nginx 1.24 or building...
registry.redhat.io/rhel8/nginx-124                Platform for running nginx 1.24 or building...
registry.redhat.io/ubi8/nginx-124                 Platform for running nginx 1.24 or building...
registry.redhat.io/ubi10/nginx-126                Platform for running nginx 1.26 or building...
registry.redhat.io/ubi9/nginx-126                 Platform for running nginx 1.26 or building...
registry.redhat.io/rhel9/nginx-126                Platform for running nginx 1.24or building n...
registry.redhat.io/rhscl/nginx-16-rhel7           Nginx 1.6 server and a reverse proxy server
registry.redhat.io/rhscl/nginx-112-rhel7          Platform for running nginx 1.12 or building...
registry.redhat.io/rhscl/nginx-116-rhel7          Platform for running nginx 1.16 or building...
registry.redhat.io/ubi7/nginx-118                 Platform for running nginx 1.18 or building...
registry.redhat.io/rhscl/nginx-120-rhel7          Platform for running nginx 1.20 or building...
```

### The container runs and doesn't exit.

```
[student@test ~]$ podman run -d -p 8080:80 registry.redhat.io/rhscl/nginx-16-rhel7
Trying to pull registry.redhat.io/rhscl/nginx-16-rhel7:latest...
Getting image source signatures
Checking if image destination supports signatures
Copying blob 972548a33962 done   |
Copying blob 9b0dee6356a1 done   |
Copying blob 0587be4dbc20 done   |
Copying config 91326f3af9 done   |
Writing manifest to image destination
Storing signatures
0e27f8bd2030d8bdf8eaf4ad518a04f5693c849a672e4b11126c3983787e5a0c

[student@test ~]$ podman ps
CONTAINER ID  IMAGE                                           COMMAND               CREATED        STATUS        PORTS                          NAMES
0e27f8bd2030  registry.redhat.io/rhscl/nginx-16-rhel7:latest  nginx -g daemon o...  5 seconds ago  Up 5 seconds  0.0.0.0:8080->80/tcp, 443/tcp  thirsty_gauss
[student@test ~]$
```

### Port 8080 is already open from a previous demo.

```
[student@test ~]$ sudo firewall-cmd --list-all
public (active)
  target: default
  icmp-block-inversion: no
  interfaces: enp0s3
  sources:
  services: cockpit dhcpv6-client http mountd nfs rpc-bind ssh
  ports: 8080/tcp
  protocols:
  forward: yes
  masquerade: no
  forward-ports:
  source-ports:
  icmp-blocks:
  rich rules:
[student@test ~]$
```


